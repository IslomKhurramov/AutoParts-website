<%- include('includes/header') %>

<link rel="stylesheet" type="text/css" href="/css/products.css" />

<body>
  <div id="main_container">
    <div class="group_name">
      <ul class="nav justify-content-center">
        <li class="nav-item" style="cursor: pointer">
          <a class="nav-link active" href="/resto">Home</a>
        </li>

        <li class="nav-item" style="cursor: pointer">
          <a class="nav-link" href="/resto/all-users">All Users</a>
        </li>
        <li class="nav-item" style="cursor: pointer">
          <a class="nav-link" href="/resto/logout">Logout</a>
        </li>
      </ul>
    </div>

    <div class="restaurant_menu_frame">
        <div class="restaurant_container">
          <div class="resto_table">
            <span class="new_dish_txt">All Users List</span>
  
            <table class="table table-hover table-sm">
              <thead class="thead-light">
                <tr class="thead-light">
                  <th class="scope">#</th>
                  <th class="scope">User Name</th>
                  <th class="scope">User Phone Number</th>
                  <th class="scope">User TOP</th>
                  <th class="scope">User Status</th>
                </tr>
              </thead>
  
              <% users_data.map(function(value, key){ %>
              <tbody style="background: white">
                <td><%= key +1 %></td>
                <td><%= value.mb_nick %></td>
                <td><%= value.mb_phone %></td>
                <td style="width: 13%">
                  <label class="switch">
                    <input type="checkbox" class="mb_top" id="<%= value._id %>" <%= value.mb_top === 'Y' ? "checked" : "" %> />
                    <span class="slider round"></span>
                  </label>
                </td>
                <td style="width: 13%">
                  <select class="spec_select mb_status" id="<%= value._id %>">
                    <option value="ONPAUSE" <%= value.mb_status === 'ONPAUSE' ? "selected" : "" %>>ONPAUSE</option>
                    <option value="ACTIVE" <%= value.mb_status === 'ACTIVE' ? "selected" : "" %>>ACTIVE</option>
                    <option value="DELETED" <%= value.mb_status === 'DELETED' ? "selected" : "" %>>DELETED</option>
                  </select>
                </td>
              </tbody>
  
              <% }); %>
            </table>
          </div>
        </div>
      </div>
      
      <li class="nav-item" style="cursor: pointer">
        <a class="nav-link" href="/resto/products/user">Products</a>
      </li>

      
    </div>

    
    <script>
      $(function(){
          $(".mb_top").on("change", function (e){
              const id= e.target.id;
              const mb_top=e.target.checked ? "Y" : "N";
  
              axios.post('/resto/all-users/edit', {id: id, mb_top: mb_top})
              .then(response => {
                  const result = response.data;
                  if(result.state==="success") alert("Successfully updated!");
                  else alert(result.message);
              }).catch(err => console.log(err))
          })
  
          $(".mb_status").on("change", function (e){
              const id= e.target.id;
              const mb_status=$(`#${id}.mb_status`).val();
              console.log(mb_status)
  
              axios.post('/resto/all-users/edit', {id: id, mb_status: mb_status})
              .then(response => {
                  const result = response.data;
                  console.log(result);
                  if(result.state==="success") alert("Successfully updated!");
                  else alert(result.message);
              }).catch(err => console.log(err))
          })
      })

      /******************************************/
      $(function (){
      
      $(".hiding_btn").on("click", ()=>{
        $(".dish_container").slideToggle(500);
        $(".hiding_btn").css("display","none");
      })

      //product status changer
      $(".new_product_status").on("change", async function(event){
        const id=event.target.id;
        const product_status=$(`#${id}.new_product_status`).val();

        try{
          const url=`/resto/products/edit/${id}`
          const response=await axios.post(url, {id:id, product_status:product_status});
          const result=response.data;
          console.log("result::::", result);
          if(result.state=="succeed"){
            alert("succeed");
            location.reload();
          }else{
            alert(result.message);
          }
        }catch(err){
          console.log("UpdateChosenProduct err:",err)
        }
      })
      //product status changer
      $(".new_product_price_status").on("change", async function(event){
        const id=event.target.id;
        const product_price_status=$(`#${id}.new_product_price_status`).val();

        try{
          const url=`/resto/products/edit/${id}`
          const response=await axios.post(url, {id:id, product_price_status:product_price_status});
          const result=response.data;
          console.log("result::::", result);
          if(result.state=="succeed"){
            alert("succeed");
            location.reload();
          }else{
            alert(result.message);
          }
        }catch(err){
          console.log("UpdateChosenProduct err:",err)
        }
      })
    });

    const plus=document.querySelector(".plus"),
    minus=document.querySelector(".minus"),
     num=$(".num").val();

    console.log(num)
    plus.addEventListener("click", ()=>{
      num++;
      a=(a<10) ? "0" + a: a;
      num.innerText=a;
      console.log(num)
    });

 

    function validateForm(){
      const user_id=$(".user_id").val();
      const product_name=$(".product_name").val();
      const product_price=$(".product_price").val();
      const product_left_cnt=$(".product_left_cnt").val();
      const product_description=$(".product_description").val();
      const product_status=$(".product_status").val();
      const product_collection=$(".product_collection").val();


      if(user_id==''||product_name==''||product_price==""||product_left_cnt==""||product_collection==''||product_description==""||product_status==""){
        alert("Iltimos hamma malumotlarni kiriting!");
        return false;
      }else return true;
    }

    function previewFileHandler(input, order){
      console.log(input);
      const image_class_name=input.className;
      // console.log("classname:", className);
      const file=$(`.${image_class_name}`).get(0).files[0],
      fileType=file["type"],
      validImageTypes=["image/jpg","image/jpeg","image/png"];

      if(!validImageTypes.includes(fileType)){
        alert("Iltimos ruxsat etilgan rasm formatlaridan foydalaning: (jpg, jpeg, png)");
      }else{
        if(file){
          let reader=new FileReader();
          reader.onload=function(){
            $(`#image_section_${order}`).attr("src", reader.result);
          }
          reader.readAsDataURL(file);
        }
      }
    }


      /*******************************************/
    </script>
</body>

<%- include('includes/footer') %>
